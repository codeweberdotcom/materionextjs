## üìã –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–æ–¥—É–ª—è —á–∞—Ç–∞

–ü–æ—Å–ª–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –º–æ–¥—É–ª—è —á–∞—Ç–∞, —è –≤—ã—è–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º.

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å)**
   - –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±–µ–∑ HTML-—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –í–æ–∑–º–æ–∂–Ω–∞ XSS –∞—Ç–∞–∫–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π JavaScript –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

2. **–°–ª–∞–±–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç rate limiting**
   - Rate limit –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
   - –õ–µ–≥–∫–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ localStorage –æ—á–∏—Å—Ç–∫—É –∏–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
   - –ù–µ—Ç server-side session-based –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

3. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - Rate limit –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage (–¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
   - –ù–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### üü° –ü—Ä–æ–±–ª–µ–º—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

1. **–ü–∞–º—è—Ç–Ω—ã–µ —É—Ç–µ—á–∫–∏ (Memory leaks)**
   ```typescript
   // –í useChatNew.ts - –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –±–µ–∑ cleanup
   const interval = setInterval(async () => {
     // ...
   }, 10000) // –ù–µ—Ç clearInterval –≤ cleanup
   ```

2. **Race conditions –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–∫–∞—Ö**
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `sendMessage` –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å
   - –ù–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
   - –í–æ–∑–º–æ–∂–Ω—ã –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö

### üü† –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å useChatNew —Ö—É–∫–∞**
   - 913 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ–º —Ö—É–∫–µ
   - –°–º–µ—à–∏–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, UI state –∏ side effects
   - –¢—Ä—É–¥–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ state management**
   - Redux + –ª–æ–∫–∞–ª—å–Ω—ã–π state –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
   - –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É optimistic updates –∏ server state

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π**
   ```typescript
   // @ts-nocheck –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ TypeScript –æ—à–∏–±–æ–∫
   // Math.random() –≤ React keys - –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏
   key={`contact-${Math.random()}-${contact.about || 'no-about'}`}
   ```

## üõ†Ô∏è –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –∏ —É–ª—É—á—à–µ–Ω–∏—è–º

### 1. **–£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

**–î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π:**
```typescript
// –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É sanitizeMessage
import DOMPurify from 'dompurify'

export const sanitizeMessage = (content: string): string => {
  return DOMPurify.sanitize(content, { ALLOWED_TAGS: [] })
}
```

**–£–ª—É—á—à–∏—Ç—å rate limiting:**
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å rate limit –ª–æ–≥–∏–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å JWT-based rate limiting

**–î–æ–±–∞–≤–∏—Ç—å Content Security Policy:**
```typescript
// –í next.config.ts
{
  async headers() {
    return [
      {
        source: '/api/chat/:path*',
        headers: [
          { key: 'X-Content-Type-Options', value: 'nosniff' },
          { key: 'X-Frame-Options', value: 'DENY' }
        ]
      }
    ]
  }
}
```

### 2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**

**–†–∞–∑–¥–µ–ª–∏—Ç—å useChatNew –Ω–∞ –º–µ–Ω—å—à–∏–µ —Ö—É–∫–∏:**
```typescript
// useChatConnection.ts - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
// useChatMessages.ts - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
// useChatRateLimit.ts - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ rate limiting
// useChatQueue.ts - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é
```

**–£–ª—É—á—à–∏—Ç—å state management:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React Query –¥–ª—è server state
// Redux —Ç–æ–ª—å–∫–æ –¥–ª—è UI state
// –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É Redux –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º state
```

**–î–æ–±–∞–≤–∏—Ç—å error boundaries:**
```typescript
class ChatErrorBoundary extends Component {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–∞—Ç–∞
}
```

### 3. **–£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏**

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å memory leaks:**
```typescript
useEffect(() => {
  const interval = setInterval(checkRateLimit, 10000)
  return () => clearInterval(interval) // –î–æ–±–∞–≤–∏—Ç—å cleanup
}, [])
```

**–î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º:**
```typescript
// –î–ª—è failed —Å–æ–æ–±—â–µ–Ω–∏–π
const retryFailedMessages = async () => {
  const failed = queuedMessages.filter(m => m.status === 'failed')
  for (const message of failed) {
    await sendMessage(message.content)
  }
}
```

**–£–ª—É—á—à–∏—Ç—å offline handling:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å background sync
// –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–æ —Ä–∞–∑—É–º–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

### 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤:**
```typescript
// react-window –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
<FixedSizeList height={400} itemCount={messages.length} itemSize={50}>
  {MessageItem}
</FixedSizeList>
```

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å re-renders:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React.memo –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
// –î–æ–±–∞–≤–∏—Ç—å useMemo –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
const normalizedMessages = useMemo(() =>
  messages.map(normalizeMessage), [messages]
)
```

### 5. **–£–ª—É—á—à–µ–Ω–∏–µ UX**

**–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å "–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è..." –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:**
```typescript
// User-friendly —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
const getErrorMessage = (error: Error): string => {
  switch (error.message) {
    case 'RATE_LIMITED': return '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.'
    case 'NETWORK_OFFLINE': return '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.'
    default: return '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.'
  }
}
```

### 6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**

**–î–æ–±–∞–≤–∏—Ç—å unit tests:**
```typescript
// –¢–µ—Å—Ç—ã –¥–ª—è —É—Ç–∏–ª–∏—Ç
describe('normalizeMessageContent', () => {
  it('should handle string input', () => {
    expect(normalizeMessageContent('hello')).toBe('hello')
  })
})
```

**–î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã:**
```typescript
// Playwright —Ç–µ—Å—Ç—ã –¥–ª—è —á–∞—Ç–∞
test('should send and receive messages', async ({ page }) => {
  // –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
})
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å TypeScript –æ—à–∏–±–∫–∏:**
- –£–±—Ä–∞—Ç—å –≤—Å–µ `@ts-nocheck`
- –î–æ–±–∞–≤–∏—Ç—å strict —Ç–∏–ø–∏–∑–∞—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å stable keys –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### 7. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
```typescript
// –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
// –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
// Rate limit –Ω–∞—Ä—É—à–µ–Ω–∏—è
```

**–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.info('Message sent', {
  messageId,
  roomId,
  senderId,
  deliveryTime: Date.now() - createdAt
})
```

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Security & Stability):**
   - –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å memory leaks
   - –£–ª—É—á—à–∏—Ç—å rate limiting

2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Architecture):**
   - –†–∞–∑–¥–µ–ª–∏—Ç—å useChatNew —Ö—É–∫
   - –£–±—Ä–∞—Ç—å @ts-nocheck
   - –î–æ–±–∞–≤–∏—Ç—å error boundaries

3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Performance & UX):**
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é
   - –£–ª—É—á—à–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ù–∞—á–∞—Ç—å —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - XSS –∏ rate limiting
2. **–†–∞–∑–¥–µ–ª–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ —ç—Ç–∞–ø—ã** - –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É
3. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ changelog

–ú–æ–¥—É–ª—å —á–∞—Ç–∞ –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –æ—Å–Ω–æ–≤—É, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.