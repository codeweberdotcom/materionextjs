# –ü–ª–∞–Ω: –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É—Å–ª–æ–≤–∏–π –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-25  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω—ã–π  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°–≤—è–∑–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:** [analysis-scenario-condition-builder-2025-11-25.md](../../analysis/architecture/analysis-scenario-condition-builder-2025-11-25.md)

---

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É—Å–ª–æ–≤–∏–π (Condition Builder) –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø AND/OR.

---

## üìã –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –¢–∏–ø—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (30 –º–∏–Ω)

**–§–∞–π–ª:** `src/components/condition-builder/types.ts`

```typescript
// –û–ø–µ—Ä–∞—Ç–æ—Ä —É—Å–ª–æ–≤–∏—è
export type ConditionOperator = 
  | 'eq' | 'ne' 
  | 'gt' | 'gte' | 'lt' | 'lte'
  | 'in' | 'contains' | 'exists' | 'isEmpty'

// –û–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ (–ø—Ä–∞–≤–∏–ª–æ)
export interface ConditionRule {
  id: string
  type: 'rule'
  field: string
  operator: ConditionOperator
  value: any
}

// –ì—Ä—É–ø–ø–∞ —É—Å–ª–æ–≤–∏–π
export interface ConditionGroup {
  id: string
  type: 'group'
  operator: 'and' | 'or'
  children: (ConditionRule | ConditionGroup)[]
}

// –î–µ—Ä–µ–≤–æ —É—Å–ª–æ–≤–∏–π (–∫–æ—Ä–µ–Ω—å –≤—Å–µ–≥–¥–∞ –≥—Ä—É–ø–ø–∞)
export type ConditionTree = ConditionGroup

// –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–ª—è
export interface FieldDefinition {
  path: string
  label: string
  type: 'string' | 'number' | 'boolean' | 'date' | 'array'
  options?: { value: string; label: string }[]
}
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Ç–∏–ø–æ–≤
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

### –≠—Ç–∞–ø 2: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ConditionRule (1 —á–∞—Å)

**–§–∞–π–ª:** `src/components/condition-builder/ConditionRule.tsx`

UI –æ–¥–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è:
```
[–ü–æ–ª–µ ‚ñº] [–û–ø–µ—Ä–∞—Ç–æ—Ä ‚ñº] [–ó–Ω–∞—á–µ–Ω–∏–µ    ] [√ó]
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã MUI:**
- `TextField` —Å `select` –¥–ª—è –ø–æ–ª—è
- `TextField` —Å `select` –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω–ø—É—Ç –∑–Ω–∞—á–µ–Ω–∏—è (text/number/select/chips)
- `IconButton` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ConditionRule
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FieldSelect (–≤—ã–±–æ—Ä –ø–æ–ª—è)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OperatorSelect (–≤—ã–±–æ—Ä –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ValueInput (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥)

---

### –≠—Ç–∞–ø 3: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ConditionGroup (1.5 —á–∞—Å–∞)

**–§–∞–π–ª:** `src/components/condition-builder/ConditionGroup.tsx`

UI –≥—Ä—É–ø–ø—ã —É—Å–ª–æ–≤–∏–π:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚óã AND  ‚óã OR                    [√ó]  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [–£—Å–ª–æ–≤–∏–µ 1]                         ‚îÇ
‚îÇ [–£—Å–ª–æ–≤–∏–µ 2]                         ‚îÇ
‚îÇ [–í–ª–æ–∂–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞]                  ‚îÇ
‚îÇ [+ –£—Å–ª–æ–≤–∏–µ] [+ –ì—Ä—É–ø–ø–∞]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã MUI:**
- `Card` / `Paper` –¥–ª—è –æ–±—Ä–∞–º–ª–µ–Ω–∏—è
- `RadioGroup` –¥–ª—è AND/OR
- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä children
- `Button` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π/–≥—Ä—É–ø–ø

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ConditionGroup
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å AND/OR
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

---

### –≠—Ç–∞–ø 4: –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ConditionBuilder (1 —á–∞—Å)

**–§–∞–π–ª:** `src/components/condition-builder/ConditionBuilder.tsx`

```typescript
interface ConditionBuilderProps {
  value: ConditionTree
  onChange: (value: ConditionTree) => void
  fields: FieldDefinition[]
  disabled?: boolean
}
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–µ—Ä–µ–≤–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON
- –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å ConditionBuilder
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —É–∑–ª–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å index.ts

---

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º—É —Å—Ü–µ–Ω–∞—Ä–∏—è (1 —á–∞—Å)

**–§–∞–π–ª:** `src/views/admin/notifications/NotificationScenarios.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è —É—Å–ª–æ–≤–∏–π –Ω–∞ `<ConditionBuilder />`
2. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `conditions: ConditionTree`
3. –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ JSON –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
4. –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–ó–∞–¥–∞—á–∏:**
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ConditionBuilder
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "–£—Å–ª–æ–≤–∏—è" –≤ –¥–∏–∞–ª–æ–≥
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π (AVAILABLE_FIELDS)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å handleSave –¥–ª—è —É—Å–ª–æ–≤–∏–π

---

### –≠—Ç–∞–ø 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ScenarioEngine (1 —á–∞—Å)

**–§–∞–π–ª:** `src/services/notifications/scenarios/ScenarioEngine.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å `evaluateConditionTree()` –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
2. –û–±–Ω–æ–≤–∏—Ç—å `checkConditions()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º

```typescript
private evaluateConditionTree(
  node: ConditionGroup | ConditionRule, 
  context: ScenarioExecutionContext
): boolean {
  if (node.type === 'rule') {
    return this.evaluateRule(node, context)
  }
  
  const results = node.children.map(child => 
    this.evaluateConditionTree(child, context)
  )
  
  return node.operator === 'and'
    ? results.every(r => r)
    : results.some(r => r)
}
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å evaluateConditionTree
- [ ] –î–æ–±–∞–≤–∏—Ç—å evaluateRule
- [ ] –û–±–Ω–æ–≤–∏—Ç—å checkConditions
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

---

### –≠—Ç–∞–ø 7: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω)

**–ó–∞–¥–∞—á–∏:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UI –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/components/condition-builder/
‚îú‚îÄ‚îÄ index.ts                    # –≠–∫—Å–ø–æ—Ä—Ç—ã
‚îú‚îÄ‚îÄ types.ts                    # –¢–∏–ø—ã
‚îú‚îÄ‚îÄ constants.ts                # –û–ø–µ—Ä–∞—Ç–æ—Ä—ã, –ø–æ–ª—è
‚îú‚îÄ‚îÄ ConditionBuilder.tsx        # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îú‚îÄ‚îÄ ConditionGroup.tsx          # –ì—Ä—É–ø–ø–∞ —É—Å–ª–æ–≤–∏–π
‚îú‚îÄ‚îÄ ConditionRule.tsx           # –û–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ
‚îî‚îÄ‚îÄ utils.ts                    # –£—Ç–∏–ª–∏—Ç—ã (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã AND/OR
- [ ] –í—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] UI –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–µ–Ω
- [ ] ScenarioEngine –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
- [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

| –≠—Ç–∞–ø | –í—Ä–µ–º—è |
|------|-------|
| –¢–∏–ø—ã –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã | 30 –º–∏–Ω |
| ConditionRule | 1 —á–∞—Å |
| ConditionGroup | 1.5 —á–∞—Å–∞ |
| ConditionBuilder | 1 —á–∞—Å |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 1 —á–∞—Å |
| ScenarioEngine | 1 —á–∞—Å |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 30 –º–∏–Ω |
| **–ò—Ç–æ–≥–æ** | **~6.5 —á–∞—Å–æ–≤** |

---

## üöÄ –ù–∞—á–∞–ª–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å –≠—Ç–∞–ø–∞ 1: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç.





