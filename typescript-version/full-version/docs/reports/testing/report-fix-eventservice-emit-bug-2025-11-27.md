# –û—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: eventService.emit is not a function

**–ü–µ—Ä–∏–æ–¥:** 2025-11-27  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω

---

## üìã –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã](../../analysis/architecture/analysis-s3-eventservice-bug-2025-11-27.md)
- [–ü–ª–∞–Ω –º–æ–¥—É–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤](../../plans/active/plan-service-configuration-module-2025-11-25.md)

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:

1. ‚úÖ **–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏**
   - –ò–∑—É—á–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏
   - –ù–∞–π–¥–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ—Ç–æ–¥–∞ `emit()` –≤–º–µ—Å—Ç–æ `record()`
   - –°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞

2. ‚úÖ **–ü–æ–∏—Å–∫ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤**
   - –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ
   - –ù–∞–π–¥–µ–Ω–æ 12 –≤—ã–∑–æ–≤–æ–≤ –≤ 8 —Ñ–∞–π–ª–∞—Ö

3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤**
   - –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã `eventService.emit()` –Ω–∞ `eventService.record()`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (actorType/actorId ‚Üí actor: {type, id})

4. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ S3 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**
   - –ó–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–ª–Ω—ã–º —Å—Ç–µ–∫–æ–º (S3, Redis, Bull, Monitoring)
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MinIO
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ! –í–µ—Ä—Å–∏—è: MinIO, Latency: 249ms"

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ S3 (MinIO) —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ HTTP 500 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º `eventService.emit is not a function`

**–í–ª–∏—è–Ω–∏–µ:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ `eventService.emit()` –Ω–∞ `eventService.record()` —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ

---

## üìä –î–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

| # | –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–π |
|---|------|-----------|
| 1 | `src/app/api/admin/settings/services/[id]/test/route.ts` | 1 |
| 2 | `src/app/api/admin/settings/services/[id]/toggle/route.ts` | 1 |
| 3 | `src/app/api/admin/settings/services/[id]/route.ts` | 2 |
| 4 | `src/app/api/admin/settings/services/route.ts` | 1 |
| 5 | `src/services/rules/RulesService.ts` | 3 |
| 6 | `src/services/scheduler/TariffExpirationScheduler.ts` | 2 |
| 7 | `src/services/workflows/WorkflowService.ts` | 1 |
| 8 | `src/services/workflows/ListingWorkflowService.ts` | 1 |

**–ò—Ç–æ–≥–æ:** 12 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ 8 —Ñ–∞–π–ª–∞—Ö

### –§–æ—Ä–º–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```typescript
// –ë–´–õ–û:
await eventService.emit({
  actorType: 'user',
  actorId: user.id,
  subjectType: 'service',
  subjectId: id,
  ...
})

// –°–¢–ê–õ–û:
await eventService.record({
  actor: { type: 'user', id: user.id },
  subject: { type: 'service', id: id },
  ...
})
```

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ S3 MinIO:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°—Ç–∞—Ç—É—Å | ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ |
| –í–µ—Ä—Å–∏—è | MinIO |
| Latency (1-–π —Ç–µ—Å—Ç) | 25149ms (–≤–∫–ª—é—á–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—é) |
| Latency (2-–π —Ç–µ—Å—Ç) | 249ms |
| HTTP —Å—Ç–∞—Ç—É—Å | 200 OK |

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- [x] –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/admin/settings/services`
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –ö–Ω–æ–ø–∫–∞ "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] S3 MinIO –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ"
- [x] –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- [x] –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å

- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–æ—Å—å:** 4 –∑–∞–¥–∞—á–∏
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** 4 –∑–∞–¥–∞—á–∏
- **–û—Å—Ç–∞–ª–æ—Å—å:** 0 –∑–∞–¥–∞—á
- **–ü—Ä–æ–≥—Ä–µ—Å—Å:** 100%

---

## üéØ –í—ã–≤–æ–¥—ã

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. –ù–∞–π–¥–µ–Ω–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏ `eventService.emit is not a function`
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ 12 –≤—ã–∑–æ–≤–æ–≤ –≤ 8 —Ñ–∞–π–ª–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ S3 MinIO

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ S3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Latency –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ~250ms
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤ EventService –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥ `record()`
2. –î–æ–±–∞–≤–∏—Ç—å TypeScript —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—ã—Å–æ–∫–∏–π latency –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ (25 —Å–µ–∫—É–Ω–¥) —Å–≤—è–∑–∞–Ω —Å –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π API route –≤ dev —Ä–µ–∂–∏–º–µ Next.js
- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ latency —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ~250ms, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

*–û—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω: 2025-11-27*




