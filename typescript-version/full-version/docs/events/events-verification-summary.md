# –°–≤–æ–¥–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Events

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2025-01-22  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. Unit —Ç–µ—Å—Ç—ã

**–ö–æ–º–∞–Ω–¥–∞:** `pnpm test:unit`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ ExportService Events (7 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ ImportService Events (6 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ BulkOperations Events (7 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ ExportService (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ ImportService (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ ImportPreviewService
- ‚úÖ UserAdapter

**–ò—Ç–æ–≥–æ:** 20+ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Events –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

### 2. Integration —Ç–µ—Å—Ç—ã

**–ö–æ–º–∞–Ω–¥–∞:** `pnpm test:integration`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ integration —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

```
‚úì tests/integration/rate-limit-admin.test.ts (8 tests) 49ms

Test Files  1 passed (1)
Tests  8 passed (8)
```

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ Rate Limit Admin API routes
- ‚úÖ States, Events, Blocks, Configuration

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–º–∞–Ω–¥–∞:** `npm run check:events`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π:** 20

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º:**
- `auth`: 9 —Å–æ–±—ã—Ç–∏–π (login_failed, login_success)
- `registration`: 10 —Å–æ–±—ã—Ç–∏–π (signup_success, signup_attempt)
- `rate_limit`: 1 —Å–æ–±—ã—Ç–∏–µ (rate_limit.warning)

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –°–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è
- ‚úÖ `correlationId` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ `actorId` —É–∫–∞–∑–∞–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

---

## üìã –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### Unit —Ç–µ—Å—Ç—ã Events

1. **ExportService Events:**
   - ‚úÖ `export.started` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - ‚úÖ `export.completed` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
   - ‚úÖ `export.failed` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   - ‚úÖ `correlationId` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
   - ‚úÖ `actorId` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **ImportService Events:**
   - ‚úÖ `import.started` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
   - ‚úÖ `import.completed` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
   - ‚úÖ `import.failed` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   - ‚úÖ `import.validation_failed` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - ‚úÖ `import.preview` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

3. **BulkOperations Events:**
   - ‚úÖ `bulk_delete` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
   - ‚úÖ `bulk_delete_success` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
   - ‚úÖ `bulk_delete_failed` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
   - ‚úÖ `bulk_activate` / `bulk_deactivate` –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è
   - ‚úÖ `bulk_status_change_success` / `bulk_status_change_failed` –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

### Integration —Ç–µ—Å—Ç—ã

- ‚úÖ API routes —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- ‚úÖ –ú–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î

- ‚úÖ –°–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- ‚úÖ `correlationId` —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è
- ‚úÖ `actorId` —É–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞

---

## üéØ E2E —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Events

**–°–æ–∑–¥–∞–Ω E2E —Ç–µ—Å—Ç:** `tests/e2e/events-integration.spec.ts`

**–î–æ—Å—Ç—É–ø–µ–Ω –≤ –∞–¥–º–∏–Ω–∫–µ:** `/admin/monitoring/testing` ‚Üí "Events Integration Verification"

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ—Å—Ç:

1. **–≠–∫—Å–ø–æ—Ä—Ç Events:**
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å—å `export.started`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å—å `export.completed`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `correlationId` —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `actorId` (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä)
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `payload` (entityType, format, recordCount)

2. **–ò–º–ø–æ—Ä—Ç Events:**
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ –∏–º–ø–æ—Ä—Ç–∞
   - ‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ `import.preview` (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª)

3. **–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Events:**
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å—å `user_management.bulk_activate`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å—å `user_management.bulk_status_change_success`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `correlationId` —Å–≤—è–∑—å
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `payload` (action, userIds)

4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π:**
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (id, source, module, type, severity, message)
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `correlationId` —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `actorId` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:

**–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/monitoring/testing`
2. –ù–∞–π–¥–∏—Ç–µ "Events Integration Verification"
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø—É—Å–∫–∞ (‚ñ∂Ô∏è)

**–ß–µ—Ä–µ–∑ CLI:**
```bash
pnpm exec playwright test tests/e2e/events-integration.spec.ts
```

---

## üéØ –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   pnpm dev:with-socket:monitoring:with-redis
   ```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏:**
   - –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (XLSX/CSV)
   - –ò–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
   - –ú–∞—Å—Å–æ–≤–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è:**
   ```bash
   npm run check:events export 5
   npm run check:events import 10
   npm run check:events user_management 10
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API:**
   ```bash
   curl "http://localhost:3000/api/admin/events?source=export&limit=10"
   ```

---

## ‚úÖ –í—ã–≤–æ–¥—ã

1. **Unit —Ç–µ—Å—Ç—ã:** ‚úÖ –í—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç, Events –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **Integration —Ç–µ—Å—Ç—ã:** ‚úÖ –í—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç, API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** ‚úÖ –°–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
4. **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-22  
**–ê–≤—Ç–æ—Ä:** AI Assistant

