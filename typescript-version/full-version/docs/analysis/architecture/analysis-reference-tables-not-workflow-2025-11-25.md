# –ê–Ω–∞–ª–∏–∑: –ü–æ—á–µ–º—É —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç workflow?

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 2025-11-25  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

**–í–æ–ø—Ä–æ—Å:** –ü–æ—á–µ–º—É —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (Language, Country, Currency, etc.) –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (RateLimitConfig, ServiceConfiguration) –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å XState workflow?

---

## üìä –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Workflow –∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏

### ‚úÖ Workflow (XState) - –¥–ª—è –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–µ–π —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

**–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω workflow:**
- –°—É—â–Ω–æ—Å—Ç—å –∏–º–µ–µ—Ç **–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª** —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- –ï—Å—Ç—å **–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞** –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–∫—Ç–æ –º–æ–∂–µ—Ç, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ, –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö)
- –ù—É–∂–µ–Ω **–∞—É–¥–∏—Ç** –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–∫—Ç–æ, –∫–æ–≥–¥–∞, –ø–æ—á–µ–º—É)
- –ï—Å—Ç—å **–ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã** –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –æ—Ç–∑—ã–≤ —Å–µ—Å—Å–∏–π, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π)

**–ü—Ä–∏–º–µ—Ä—ã:**
- ‚úÖ **User:** `active` ‚Üí `suspended` ‚Üí `blocked` ‚Üí `deleted`
  - Guards: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤, –∏–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π
  - Actions: –æ—Ç–∑—ã–≤ —Å–µ—Å—Å–∏–π, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **Listing:** `draft` ‚Üí `pending` ‚Üí `active` ‚Üí `rejected` ‚Üí `archived`
  - Guards: –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏, –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  - Actions: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ø—É–±–ª–∏–∫–∞—Ü–∏—è, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è
- ‚úÖ **UserAccount:** `active` ‚Üí `suspended` ‚Üí `archived`
  - Guards: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞—Ä–∏—Ñ–∞, –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  - Actions: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π

---

### ‚ùå –ü—Ä–æ—Å—Ç—ã–µ —Ñ–ª–∞–≥–∏ (isActive/enabled) - –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**–ö–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ñ–ª–∞–≥–∞:**
- –°—É—â–Ω–æ—Å—Ç—å **–Ω–µ –∏–º–µ–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞** - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –¥–∞–Ω–Ω—ã–µ
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ `true`/`false` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç **–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª**
- –ù–µ—Ç **–ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤** –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è **—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏/–≤–∞–ª–∏–¥–∞—Ü–∏–∏** –≤ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç—è—Ö

**–ü—Ä–∏–º–µ—Ä—ã:**
- ‚ùå **Language:** `isActive: true/false`
  - –ü—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —è–∑—ã–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞
  - –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –Ω–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
- ‚ùå **Currency:** `isActive: true/false`
  - –ü—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –≤–∞–ª—é—Ç–∞
  - –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –Ω–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
- ‚ùå **RateLimitConfig:** `isActive: true/false`
  - –ü—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  - –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –Ω–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

---

## üîç –ö–∞–∫ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ Rules Engine

–•–æ—Ç—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ **–Ω–µ –∏–º–µ—é—Ç workflow**, –∏—Ö —Ñ–ª–∞–≥–∏ `isActive` **–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö** –∫–∞–∫ —É—Å–ª–æ–≤–∏—è!

### ‚úÖ Async Facts –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω–æ)

–¢–µ–ø–µ—Ä—å –≤ Rules Engine –µ—Å—Ç—å —Ñ–∞–∫—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤:

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞
languageFact: {
  name: 'language',
  resolver: async (params) => {
    const language = await prisma.language.findUnique({
      where: { code: params.languageCode }
    })
    return {
      code: language.code,
      isActive: language.isActive
    }
  }
}

// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è currency, country, tariffPlan, emailTemplate
```

### üìã –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤

#### 1. –ü—Ä–∞–≤–∏–ª–æ: –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —è–∑—ã–∫–∏

```json
{
  "name": "notification-only-active-language",
  "conditions": {
    "all": [
      { "fact": "event", "operator": "equal", "value": "notification.send", "path": "$.type" },
      { "fact": "user", "operator": "notEqual", "value": null },
      { "fact": "language", "operator": "equal", "value": true, "path": "$.isActive" }
    ]
  },
  "event": {
    "type": "notification.send",
    "params": { "channels": ["email"] }
  }
}
```

#### 2. –ü—Ä–∞–≤–∏–ª–æ: –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –≤–∞–ª—é—Ç–æ–π

```json
{
  "name": "listing-only-active-currency",
  "conditions": {
    "all": [
      { "fact": "event", "operator": "equal", "value": "listing.created", "path": "$.type" },
      { "fact": "listing", "operator": "notEqual", "value": null },
      { "fact": "currency", "operator": "equal", "value": true, "path": "$.isActive" }
    ]
  },
  "event": {
    "type": "listing.reject",
    "params": { "reason": "–í–∞–ª—é—Ç–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞" }
  }
}
```

#### 3. –ü—Ä–∞–≤–∏–ª–æ: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–∞—Ä–∏—Ñ–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞

```json
{
  "name": "account-only-active-tariff",
  "conditions": {
    "all": [
      { "fact": "event", "operator": "equal", "value": "account.created", "path": "$.type" },
      { "fact": "account", "operator": "notEqual", "value": null },
      { "fact": "tariffPlan", "operator": "equal", "value": true, "path": "$.isActive" }
    ]
  },
  "event": {
    "type": "account.suspend",
    "params": { "reason": "–¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω" }
  }
}
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

| –°—É—â–Ω–æ—Å—Ç—å | –¢–∏–ø | Workflow | Async Facts | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö |
|----------|-----|----------|-------------|-------------------------|
| **User** | –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—å | ‚úÖ XState | ‚úÖ userFact | ‚úÖ –£—Å–ª–æ–≤–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è |
| **Listing** | –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—å | ‚úÖ XState | ‚úÖ listingFact | ‚úÖ –£—Å–ª–æ–≤–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è |
| **UserAccount** | –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—å | ‚úÖ XState | ‚úÖ accountFact | ‚úÖ –£—Å–ª–æ–≤–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è |
| **Language** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ | ‚ùå –§–ª–∞–≥ | ‚úÖ languageFact | ‚úÖ –£—Å–ª–æ–≤–∏—è (isActive) |
| **Currency** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ | ‚ùå –§–ª–∞–≥ | ‚úÖ currencyFact | ‚úÖ –£—Å–ª–æ–≤–∏—è (isActive) |
| **Country** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ | ‚ùå –§–ª–∞–≥ | ‚úÖ countryFact | ‚úÖ –£—Å–ª–æ–≤–∏—è (isActive) |
| **TariffPlan** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ | ‚ùå –§–ª–∞–≥ | ‚úÖ tariffPlanFact | ‚úÖ –£—Å–ª–æ–≤–∏—è (isActive) |
| **EmailTemplate** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ | ‚ùå –§–ª–∞–≥ | ‚úÖ emailTemplateFact | ‚úÖ –£—Å–ª–æ–≤–∏—è (isActive) |
| **RateLimitConfig** | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | ‚ùå –§–ª–∞–≥ | ‚úÖ rateLimitConfigFact | ‚úÖ –£—Å–ª–æ–≤–∏—è (isActive) |
| **ServiceConfiguration** | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | ‚ùå –§–ª–∞–≥ | ‚ùå –ù–µ –Ω—É–∂–Ω–æ | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö |

---

## ‚úÖ –í—ã–≤–æ–¥

### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- ‚ùå **–ù–ï —Ç—Ä–µ–±—É—é—Ç** workflow (XState) - –Ω–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- ‚úÖ **–ù–û –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è** –≤ Rules Engine —á–µ—Ä–µ–∑ async facts –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `isActive`
- ‚úÖ **–ü–æ–∑–≤–æ–ª—è—é—Ç** —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Å —É—Å–ª–æ–≤–∏—è–º–∏ —Ç–∏–ø–∞ "—Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —è–∑—ã–∫–∏/–≤–∞–ª—é—Ç—ã/—Å—Ç—Ä–∞–Ω—ã"

### –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏:
- ‚úÖ **–¢—Ä–µ–±—É—é—Ç** workflow (XState) - –µ—Å—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è** –≤ Rules Engine –¥–ª—è —É—Å–ª–æ–≤–∏–π –ò –¥–µ–π—Å—Ç–≤–∏–π (–ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π)
- ‚úÖ **–ò–º–µ—é—Ç** guards, actions, –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã

**–ò—Ç–æ–≥:** –í—Å–µ –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö (–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –∏ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏), —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ async facts! üéâ

