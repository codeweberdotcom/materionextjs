# –ê–Ω–∞–ª–∏–∑: SQLite-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ PostgreSQL

**–î–∞—Ç–∞:** 2025-11-28  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à—ë–Ω  
**–¶–µ–ª—å:** –í—ã—è–≤–∏—Ç—å –≤—Å–µ workaround'—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π SQLite, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ PostgreSQL

---

## üìä –°–≤–æ–¥–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|-----------|:----------:|:-----------------------------:|
| **Retry –ª–æ–≥–∏–∫–∞** | 5 –º–µ—Å—Ç | üî¥ –í—ã—Å–æ–∫–æ–µ |
| **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ concurrency** | 4 –æ—á–µ—Ä–µ–¥–∏ | üî¥ –í—ã—Å–æ–∫–æ–µ |
| **Batch size —É–º–µ–Ω—å—à–µ–Ω** | 2 –º–µ—Å—Ç–∞ | üü† –°—Ä–µ–¥–Ω–µ–µ |
| **Non-blocking –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | 2 –º–µ—Å—Ç–∞ | üü† –°—Ä–µ–¥–Ω–µ–µ |
| **Transaction timeouts** | 1 –º–µ—Å—Ç–æ | üü° –ù–∏–∑–∫–æ–µ |
| **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** | 2 –º–µ—Å—Ç–∞ | üü° –ù–∏–∑–∫–æ–µ |

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—É–±—Ä–∞—Ç—å –ø—Ä–∏ PostgreSQL)

### 1. Retry Wrapper –¥–ª—è SQLite (`withDbRetry`)

**–§–∞–π–ª:** `src/lib/db/retry.ts`

```typescript
// SQLITE-SPECIFIC: –í—Å—è —ç—Ç–∞ —É—Ç–∏–ª–∏—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è SQLite
export async function withDbRetry<T>(
  operation: () => Promise<T>,
  options: {
    maxRetries?: number     // 5 –ø–æ–ø—ã—Ç–æ–∫ (–±—ã–ª–æ –±—ã 0 –¥–ª—è PostgreSQL)
    baseDelay?: number      // 150ms –∑–∞–¥–µ—Ä–∂–∫–∞
    context?: string
  } = {}
): Promise<T> {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º SQLite-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
  const isRetryable = 
    lastError.message.includes('timed out') || 
    lastError.message.includes('SQLITE_BUSY') ||        // ‚Üê SQLite only
    lastError.message.includes('database is locked') || // ‚Üê SQLite only
    lastError.message.includes('Operations timed out')
  // ...
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ:**

| –§–∞–π–ª | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ |
|------|:------------------:|
| `MediaSyncWorker.ts` | 4 |
| `MediaSyncService.ts` | 4 |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è PostgreSQL:**
- ‚ùå **–£–¥–∞–ª–∏—Ç—å** `withDbRetry` wrapper –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ PostgreSQL –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞—Ç–∏–≤–Ω–æ
- ‚ö†Ô∏è –û—Å—Ç–∞–≤–∏—Ç—å retry —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ (–Ω–µ –ë–î)

---

### 2. –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π Concurrency –≤ –æ—á–µ—Ä–µ–¥—è—Ö

**–ë—ã–ª–æ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ):** `concurrency: 5-10`  
**–°—Ç–∞–ª–æ (–¥–ª—è SQLite):** `concurrency: 3`

| –§–∞–π–ª | –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –¥–ª—è PostgreSQL |
|------|:----------------:|:--------------------------:|
| `MediaProcessingQueue.ts` | 3 | **10** |
| `MediaSyncQueue.ts` | 3 | **8** |
| `WatermarkQueue.ts` | 3 | **5** |

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

```typescript
// MediaProcessingQueue.ts
const QUEUE_CONFIG = {
  name: 'media-processing',
  concurrency: 3, // ‚Üê SQLITE: –±—ã–ª–æ 5, —É–º–µ–Ω—å—à–∏–ª–∏ –¥–æ 3
  // PostgreSQL: –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 10
}

// MediaSyncQueue.ts
const QUEUE_CONFIG = {
  name: 'media-sync',
  concurrency: 3, // ‚Üê SQLITE: "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è SQLite"
  // PostgreSQL: –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 8
}
```

**–í–ª–∏—è–Ω–∏–µ:**
- SQLite: 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–∏ max ‚Üí —á–∞—Å—Ç—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- PostgreSQL: 100+ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π ‚Üí –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è PostgreSQL:**
- ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å `concurrency` –¥–æ 8-10
- ‚úÖ –£–±—Ä–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–æ SQLite

---

### 3. –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π Batch Size

**–§–∞–π–ª:** `src/services/media/sync/MediaSyncService.ts`

```typescript
const BATCH_CONFIG = {
  batchSize: 50,           // ‚Üê SQLITE: –±—ã–ª–æ 100, —É–º–µ–Ω—å—à–∏–ª–∏ –¥–æ 50
  minFilesForBatching: 30, // ‚Üê SQLITE: –±—ã–ª–æ 50, —É–º–µ–Ω—å—à–∏–ª–∏ –¥–æ 30
  parallelLimit: 5,        // ‚Üê SQLITE: –±—ã–ª–æ 10, —É–º–µ–Ω—å—à–∏–ª–∏ –¥–æ 5
}
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | SQLite | PostgreSQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ) |
|----------|:------:|:-------------------------:|
| `batchSize` | 50 | **200** |
| `minFilesForBatching` | 30 | **100** |
| `parallelLimit` | 5 | **20** |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è PostgreSQL:**
- ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å batch size –¥–æ 200
- ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å parallelLimit –¥–æ 20
- ‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö batch'–∞—Ö

---

## üü† –°—Ä–µ–¥–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

### 4. Non-blocking –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–§–∞–π–ª:** `src/services/media/sync/MediaSyncService.ts`

```typescript
// SQLITE: –°–¥–µ–ª–∞–ª–∏ non-blocking —á—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
withDbRetry(
  () => prisma.mediaSyncJob.update({...}),
  { context: 'updateSyncProgress' }
).catch(err => {
  // –¢–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ–º, –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
  logger.warn('[MediaSyncService] Progress update failed (non-critical)')
})
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Ä—è–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏—è –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è PostgreSQL:**
- ‚úÖ –í–µ—Ä–Ω—É—Ç—å `await` –ø–µ—Ä–µ–¥ `withDbRetry`
- ‚úÖ –£–±—Ä–∞—Ç—å `.catch()` "–ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–Ω–∏–µ" –æ—à–∏–±–∫–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤

```typescript
// PostgreSQL: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π await
await prisma.mediaSyncJob.update({
  where: { id: jobId },
  data: { processedFiles, failedFiles, processedBytes }
})
```

---

### 5. Transaction Timeout

**–§–∞–π–ª:** `src/services/media/queue/MediaSyncWorker.ts`

```typescript
return await prisma.$transaction(async (tx) => {
  // ...
}, {
  timeout: 10000, // ‚Üê SQLITE: 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
})
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è PostgreSQL:**
- ‚úÖ –£–±—Ä–∞—Ç—å `timeout` (PostgreSQL —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∞–º)
- ‚úÖ –ò–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 30000ms –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

### 6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–§–∞–π–ª—ã:**
- `MediaSyncWorker.ts`: `currentResults.slice(-100)` ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100
- `MediaSyncService.ts`: `results.slice(-50)` ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50

```typescript
// SQLITE: –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å JSON –≤ –ë–î
if (currentResults.length > 100) {
  currentResults = currentResults.slice(-100) // ‚Üê –¢–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ!
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è PostgreSQL:**
- ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –¥–æ 1000 –∏–ª–∏ —É–±—Ä–∞—Ç—å —Å–æ–≤—Å–µ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–µ—Å–ª–∏ –º–Ω–æ–≥–æ)
- ‚ö†Ô∏è PostgreSQL JSONB —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏

---

## üü° –ú–∏–Ω–æ—Ä–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å)

### 7. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–æ SQLite

–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è SQLite" –≤:

- `MediaProcessingQueue.ts`
- `MediaSyncQueue.ts`  
- `MediaSyncService.ts`
- `MediaSyncWorker.ts`

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Å—Ä–∞–∑—É)

- [ ] –£–±—Ä–∞—Ç—å –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `withDbRetry` –≤ `src/lib/db/retry.ts`
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å `concurrency` –≤ `MediaProcessingQueue.ts` –¥–æ 10
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å `concurrency` –≤ `MediaSyncQueue.ts` –¥–æ 8
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å `BATCH_CONFIG` –≤ `MediaSyncService.ts`

### –í–∞–∂–Ω—ã–µ (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

- [ ] –£–±—Ä–∞—Ç—å non-blocking –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ `MediaSyncService.ts`
- [ ] –£–±—Ä–∞—Ç—å transaction timeout –≤ `MediaSyncWorker.ts`
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç results –≤ `MediaSyncWorker.ts`
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç results –≤ `MediaSyncService.ts`

### –ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ

- [ ] –£–¥–∞–ª–∏—Ç—å SQLite-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | SQLite | PostgreSQL | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|:------:|:----------:|:---------:|
| **Concurrency –æ—á–µ—Ä–µ–¥–µ–π** | 3 | 10 | **3.3x** |
| **Batch size** | 50 | 200 | **4x** |
| **Parallel limit** | 5 | 20 | **4x** |
| **Timeout –æ—à–∏–±–∫–∏** | –ß–∞—Å—Ç–æ | –†–µ–¥–∫–æ | **~0** |
| **Retry –ø–æ–ø—ã—Ç–∫–∏** | 5 | 0-1 | **5x –º–µ–Ω—å—à–µ** |
| **1000 —Ñ–∞–π–ª–æ–≤ sync** | ~5 –º–∏–Ω | ~1 –º–∏–Ω | **5x –±—ã—Å—Ç—Ä–µ–µ** |

---

## üîß –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å SQLite workaround'–∞–º–∏:

| –§–∞–π–ª | –¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|---------------|:---------:|
| `src/lib/db/retry.ts` | –£–¥–∞–ª–∏—Ç—å/–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å | üî¥ –í—ã—Å–æ–∫–∏–π |
| `src/services/media/queue/MediaProcessingQueue.ts` | –£–≤–µ–ª–∏—á–∏—Ç—å concurrency | üî¥ –í—ã—Å–æ–∫–∏–π |
| `src/services/media/queue/MediaSyncQueue.ts` | –£–≤–µ–ª–∏—á–∏—Ç—å concurrency | üî¥ –í—ã—Å–æ–∫–∏–π |
| `src/services/media/queue/WatermarkQueue.ts` | –£–≤–µ–ª–∏—á–∏—Ç—å concurrency | üü† –°—Ä–µ–¥–Ω–∏–π |
| `src/services/media/sync/MediaSyncService.ts` | BATCH_CONFIG + await | üî¥ –í—ã—Å–æ–∫–∏–π |
| `src/services/media/queue/MediaSyncWorker.ts` | Retry + results limit | üü† –°—Ä–µ–¥–Ω–∏–π |

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞)
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL Docker
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Prisma
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —Ä–∞–±–æ—Ç—É

### –≠—Ç–∞–ø 2: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ concurrency
1. –ò–∑–º–µ–Ω–∏—Ç—å `concurrency` –≤ –æ—á–µ—Ä–µ–¥—è—Ö
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Å–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –ë–î

### –≠—Ç–∞–ø 3: –£–¥–∞–ª–µ–Ω–∏–µ SQLite workaround'–æ–≤
1. –£–±—Ä–∞—Ç—å `withDbRetry` –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å
2. –í–µ—Ä–Ω—É—Ç—å `await` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
3. –£–≤–µ–ª–∏—á–∏—Ç—å batch size –∏ limits

### –≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling
2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ slow queries

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ PostgreSQL **–º–æ–∂–Ω–æ –∏ –Ω—É–∂–Ω–æ**:

1. **–£–±—Ä–∞—Ç—å** ~80% retry –ª–æ–≥–∏–∫–∏ (SQLite-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π)
2. **–£–≤–µ–ª–∏—á–∏—Ç—å** concurrency –≤ 3-4 —Ä–∞–∑–∞
3. **–£–≤–µ–ª–∏—á–∏—Ç—å** batch size –≤ 4 —Ä–∞–∑–∞
4. **–í–µ—Ä–Ω—É—Ç—å** –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

–≠—Ç–æ –¥–∞—Å—Ç **5-10x —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–µ–¥–∏–∞.

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–ü–ª–∞–Ω: PostgreSQL Docker Setup](../../plans/active/plan-postgresql-docker-setup-2025-11-28.md)
- [–û—Ç—á—ë—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQLite timeout](../../reports/fixes/report-media-sync-sqlite-fixes-2025-11-28.md)

