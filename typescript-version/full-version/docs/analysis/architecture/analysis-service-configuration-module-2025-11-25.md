# ะะฝะฐะปะธะท ะผะพะดัะปั ะบะพะฝัะธะณััะฐัะธะธ ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ (Service Configuration)

**ะะฐัะฐ ะฟัะพะฒะตะดะตะฝะธั:** 2025-11-25  
**ะกัะฐััั:** ะะฐะฒะตััะตะฝ  
**ะัะธะพัะธัะตั:** ะััะพะบะธะน

---

## ๐ฏ ะฆะตะปั ะฐะฝะฐะปะธะทะฐ

ะะฐะทัะฐะฑะพัะฐัั ะฐััะธัะตะบัััั ะผะพะดัะปั ะดะปั ะดะธะฝะฐะผะธัะตัะบะพะณะพ ัะฟัะฐะฒะปะตะฝะธั ะฟะพะดะบะปััะตะฝะธัะผะธ ะบ ะฒะฝะตัะฝะธะผ ัะตัะฒะธัะฐะผ (Redis, Prometheus, Loki, Grafana, Sentry) ัะตัะตะท ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั ั ะฟะพะดะดะตัะถะบะพะน ะณะธะฑัะธะดะฝะพะณะพ ัะตะถะธะผะฐ ัะฐะฑะพัั:
- **Development**: Docker-ะบะพะฝัะตะนะฝะตัั ะธะท ะฟะฐะฟะพะบ ะฟัะพะตะบัะฐ
- **Staging**: ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)
- **Production**: ะะพะฝัะธะณััะฐัะธั ัะตัะตะท ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั

---

## ๐ ะขะตะบััะตะต ัะพััะพัะฝะธะต

### ะงัะพ ะฐะฝะฐะปะธะทะธััะตััั:

1. **ะกััะตััะฒัััะธะต ะฟะพะดะบะปััะตะฝะธั ะบ ัะตัะฒะธัะฐะผ:**
   - Redis: `REDIS_URL` ะฒ `.env` (NotificationQueue, RateLimitStore, RoleCacheStore)
   - Prometheus: ะปะพะบะฐะปัะฝะพ ัะตัะตะท `prom-client`
   - Loki: ัะตัะตะท Promtail (Docker)
   - Grafana: ัะตัะตะท Docker Compose
   - Sentry: `SENTRY_DSN` ะฒ `.env`

2. **ะกะฒัะทะฐะฝะฝัะต ะบะพะผะฟะพะฝะตะฝัั/ะผะพะดัะปะธ:**
   - `src/services/notifications/NotificationQueue.ts` - ะธัะฟะพะปัะทัะตั Redis
   - `src/lib/rate-limit/stores/redis-store.ts` - ะธัะฟะพะปัะทัะตั Redis
   - `src/lib/role-cache/redis-store.ts` - ะธัะฟะพะปัะทัะตั Redis
   - `src/app/api/health/route.ts` - ะฟัะพะฒะตััะตั Redis
   - `src/app/api/admin/monitoring/dashboard/route.ts` - ะฟัะพะฒะตััะตั Redis

### ะะตัะพะดะพะปะพะณะธั:

- ะะฝะฐะปะธะท ะบะพะดะพะฒะพะน ะฑะฐะทั ะฝะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต env-ะฟะตัะตะผะตะฝะฝัั ะดะปั ัะตัะฒะธัะพะฒ
- ะะฝะฐะปะธะท ััะตะฑะพะฒะฐะฝะธะน ะบ ะฑะตะทะพะฟะฐัะฝะพััะธ ััะฐะฝะตะฝะธั credentials
- ะััะปะตะดะพะฒะฐะฝะธะต ะฟะฐััะตัะฝะพะฒ ะดะธะฝะฐะผะธัะตัะบะพะน ะบะพะฝัะธะณััะฐัะธะธ

---

## ๐ ะะตะทัะปััะฐัั ะฐะฝะฐะปะธะทะฐ

### ะะฐะนะดะตะฝะฝัะต ะฟัะพะฑะปะตะผั:

1. **ะััััััะฒะธะต ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะณะพ ัะฟัะฐะฒะปะตะฝะธั**
   - ะะฟะธัะฐะฝะธะต: ะะฐะถะดัะน ะผะพะดัะปั ัะฐะผะพััะพััะตะปัะฝะพ ัะธัะฐะตั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
   - ะะปะธัะฝะธะต: ะััะพะบะพะต
   - ะัะธะพัะธัะตั: ะัะธัะธัะตัะบะธะน
   - ะัะธะผะตั:
     ```typescript
     // ะ ะบะฐะถะดะพะผ ะผะพะดัะปะต ะพัะดะตะปัะฝะพ
     const redisUrl = process.env.REDIS_URL
     ```

2. **ะะตะฒะพะทะผะพะถะฝะพััั ะธะทะผะตะฝะตะฝะธั ะบะพะฝัะธะณััะฐัะธะธ ะฑะตะท ะฟะตัะตะทะฐะฟััะบะฐ**
   - ะะฟะธัะฐะฝะธะต: ะัะธ ะธะทะผะตะฝะตะฝะธะธ .env ััะตะฑัะตััั ะฟะตัะตะทะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั
   - ะะปะธัะฝะธะต: ะกัะตะดะฝะตะต
   - ะัะธะพัะธัะตั: ะััะพะบะธะน

3. **ะััััััะฒะธะต UI ะดะปั ัะฟัะฐะฒะปะตะฝะธั ัะตัะฒะธัะฐะผะธ**
   - ะะฟะธัะฐะฝะธะต: ะะตั ัะฟะพัะพะฑะฐ ะฟัะพัะผะพััะตัั/ะธะทะผะตะฝะธัั ะฟะพะดะบะปััะตะฝะธั ัะตัะตะท ะฐะดะผะธะฝะบั
   - ะะปะธัะฝะธะต: ะกัะตะดะฝะตะต
   - ะัะธะพัะธัะตั: ะััะพะบะธะน

4. **Credentials ะฒ ะพัะบัััะพะผ ะฒะธะดะต**
   - ะะฟะธัะฐะฝะธะต: ะะฐัะพะปะธ ะฒ .env ัะฐะนะปะฐั ะฝะต ะทะฐัะธััะพะฒะฐะฝั
   - ะะปะธัะฝะธะต: ะััะพะบะพะต (ะฑะตะทะพะฟะฐัะฝะพััั)
   - ะัะธะพัะธัะตั: ะัะธัะธัะตัะบะธะน

5. **ะััััััะฒะธะต ัะตััะธัะพะฒะฐะฝะธั ะฟะพะดะบะปััะตะฝะธะน**
   - ะะฟะธัะฐะฝะธะต: ะะตั ะฒะพะทะผะพะถะฝะพััะธ ะฟัะพะฒะตัะธัั ะฟะพะดะบะปััะตะฝะธะต ะดะพ ะตะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
   - ะะปะธัะฝะธะต: ะกัะตะดะฝะตะต
   - ะัะธะพัะธัะตั: ะกัะตะดะฝะธะน

### ะะฐะนะดะตะฝะฝัะต ะฒะพะทะผะพะถะฝะพััะธ:

1. **ะฃะฝะธัะธะบะฐัะธั ะฟะพะดะบะปััะตะฝะธะน**
   - ะะฟะธัะฐะฝะธะต: ะกะพะทะดะฐัั ะตะดะธะฝัะน ServiceConfigResolver ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ
   - ะะพัะตะฝัะธะฐะปัะฝะฐั ะฒัะณะพะดะฐ: ะฃะฟัะพัะตะฝะธะต ะบะพะดะฐ, ะตะดะธะฝะฐั ัะพัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

2. **ะะธะฑัะธะดะฝัะน ัะตะถะธะผ ัะฐะฑะพัั**
   - ะะฟะธัะฐะฝะธะต: ะัะธะพัะธัะตัั Admin โ ENV โ Default (Docker)
   - ะะพัะตะฝัะธะฐะปัะฝะฐั ะฒัะณะพะดะฐ: ะะฐะฑะพัะฐะตั ะบะฐะบ ะฒ development, ัะฐะบ ะธ ะฒ production

3. **ะจะธััะพะฒะฐะฝะธะต credentials**
   - ะะฟะธัะฐะฝะธะต: AES-256-GCM ัะธััะพะฒะฐะฝะธะต ะดะปั ััะฒััะฒะธัะตะปัะฝัั ะดะฐะฝะฝัั
   - ะะพัะตะฝัะธะฐะปัะฝะฐั ะฒัะณะพะดะฐ: ะกะพะพัะฒะตัััะฒะธะต ััะตะฑะพะฒะฐะฝะธัะผ ะฑะตะทะพะฟะฐัะฝะพััะธ

4. **Health checks ัะตัะตะท UI**
   - ะะฟะธัะฐะฝะธะต: ะขะตััะธัะพะฒะฐะฝะธะต ะฟะพะดะบะปััะตะฝะธะน ะบ ัะตัะฒะธัะฐะผ ะธะท ะฐะดะผะธะฝะบะธ
   - ะะพัะตะฝัะธะฐะปัะฝะฐั ะฒัะณะพะดะฐ: ะฃะฟัะพัะตะฝะธะต ะดะธะฐะณะฝะพััะธะบะธ

---

## ๐๏ธ ะััะธัะตะบัััะฐ ัะตัะตะฝะธั

### ะกัะตะผะฐ ะฟัะธะพัะธัะตัะพะฒ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ServiceConfigResolver                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
            โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโ
            โผ                  โผ                  โผ
    โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ
    โ 1๏ธโฃ Admin (DB) โ  โ 2๏ธโฃ ENV (.env) โ  โ 3๏ธโฃ Default    โ
    โ   ะัะธะพัะธัะตั 1  โ  โ   ะัะธะพัะธัะตั 2  โ  โ   (Docker)    โ
    โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโ
           โ                   โ                  โ
           โผ                   โผ                  โผ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                    Production | Staging | Development       โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะกัััะบัััะฐ ะผะพะดัะปั:

```
src/
โโโ lib/
โ   โโโ config/
โ       โโโ index.ts                    # ะญะบัะฟะพััั
โ       โโโ ServiceConfigResolver.ts    # ะฆะตะฝััะฐะปัะฝัะน ัะตะทะพะปะฒะตั
โ       โโโ types.ts                    # ะขะธะฟั
โ       โโโ encryption.ts               # ะจะธััะพะฒะฐะฝะธะต credentials
โ
โโโ modules/
โ   โโโ settings/
โ       โโโ services/
โ           โโโ index.ts
โ           โโโ ServiceConfigurationService.ts
โ           โโโ connectors/
โ           โ   โโโ BaseConnector.ts
โ           โ   โโโ RedisConnector.ts
โ           โ   โโโ PrometheusConnector.ts
โ           โ   โโโ LokiConnector.ts
โ           โ   โโโ GrafanaConnector.ts
โ           โ   โโโ SentryConnector.ts
โ           โโโ validators.ts           # Zod ััะตะผั
โ
โโโ app/
โ   โโโ api/
โ   โ   โโโ admin/
โ   โ       โโโ settings/
โ   โ           โโโ services/
โ           โ       โโโ route.ts        # CRUD
โ           โ       โโโ [id]/
โ           โ           โโโ route.ts    # GET, PUT, DELETE
โ           โ           โโโ test/
โ           โ               โโโ route.ts # Test connection
โ   โ
โ   โโโ (dashboard)/
โ       โโโ admin/
โ           โโโ settings/
โ               โโโ services/
โ                   โโโ page.tsx        # UI

prisma/
โโโ schema.prisma                       # + ServiceConfiguration model
```

### Prisma ะผะพะดะตะปั:

```prisma
model ServiceConfiguration {
  id          String   @id @default(cuid())
  
  // ะะดะตะฝัะธัะธะบะฐัะธั
  name        String   @unique  // redis, prometheus, loki, grafana, sentry
  displayName String            // "Redis Server", "Prometheus"
  type        ServiceType
  
  // ะะพะดะบะปััะตะฝะธะต
  host        String
  port        Int?
  protocol    String?           // redis://, https://
  basePath    String?           // /api/v1
  
  // ะััะตะฝัะธัะธะบะฐัะธั (ะทะฐัะธััะพะฒะฐะฝะพ AES-256-GCM)
  username    String?
  password    String?           // ะะฐัะธััะพะฒะฐะฝะพ
  token       String?           // API ัะพะบะตะฝ (ะทะฐัะธััะพะฒะฐะฝะพ)
  tlsEnabled  Boolean  @default(false)
  tlsCert     String?           // ะกะตััะธัะธะบะฐั (ะทะฐัะธััะพะฒะฐะฝะพ)
  
  // ะกัะฐััั
  enabled     Boolean  @default(true)
  status      ServiceStatus @default(UNKNOWN)
  lastCheck   DateTime?
  lastError   String?
  
  // ะะตัะฐ
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  
  @@map("service_configurations")
}

enum ServiceType {
  REDIS
  PROMETHEUS
  LOKI
  GRAFANA
  SENTRY
  SMTP
  S3
  ELASTICSEARCH
}

enum ServiceStatus {
  CONNECTED
  DISCONNECTED
  ERROR
  UNKNOWN
}
```

---

## โ ะกะพะพัะฒะตัััะฒะธะต AI_MODULE_STANDARDS.md

### ะคัะฝะบัะธะพะฝะฐะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั:

| ะขัะตะฑะพะฒะฐะฝะธะต | ะกะพะพัะฒะตัััะฒะธะต | ะะพะผะผะตะฝัะฐัะธะน |
|------------|--------------|-------------|
| ะกะพะพัะฒะตัััะฒะธะต ะฐััะธัะตะบัััะต | โ | ะัะฟะพะปัะทัะตั `src/modules`, `src/lib`, `src/app/api` |
| ะกะธะฝััะพะฝะธะทะฐัะธั ั docs | โ | ะะฑะฝะพะฒะปะตะฝะธะต API docs, permissions |
| i18n ะฟะพะดะดะตัะถะบะฐ | โ | ะะพะบะฐะปะธะทะฐัะธั UI ัััะฐะฝะธัั |
| ะะฐะปะธะดะฐัะธั Zod | โ | ะกัะตะผั ะดะปั API ะฒัะพะดะฝัั ะดะฐะฝะฝัั |
| Failure mode | โ | Fallback ะฝะฐ ENV โ Default |

### ะะตััะฝะบัะธะพะฝะฐะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั:

| ะขัะตะฑะพะฒะฐะฝะธะต | ะกะพะพัะฒะตัััะฒะธะต | ะะตะฐะปะธะทะฐัะธั |
|------------|--------------|------------|
| ะะตะทะพะฟะฐัะฝะพััั | โ | AES-256-GCM ัะธััะพะฒะฐะฝะธะต, ะฟัะพะฒะตัะบะฐ ะฟัะฐะฒ admin |
| ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั | โ | ะััะธัะพะฒะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะน (TTL 60s) |
| ะะฐะดัะถะฝะพััั | โ | Prometheus ะผะตััะธะบะธ, ะปะพะณะธัะพะฒะฐะฝะธะต, health checks |
| UX/UI | โ | MUI ะบะพะผะฟะพะฝะตะฝัั, ัะพััะพัะฝะธั ะทะฐะณััะทะบะธ/ะพัะธะฑะบะธ |
| ะะพะบัะผะตะฝัะฐัะธั | โ | API docs, user guide, STATUS_INDEX |

---

## ๐ก ะะตะบะพะผะตะฝะดะฐัะธะธ

1. **ะะตะบะพะผะตะฝะดะฐัะธั 1: ะกะพะทะดะฐัั ServiceConfigResolver**
   - ะะฟะธัะฐะฝะธะต: ะฆะตะฝััะฐะปัะฝัะน ัะตะทะพะปะฒะตั ั ะฟัะธะพัะธัะตัะฐะผะธ Admin โ ENV โ Default
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะกัะตะดะฝัั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 1 ะดะตะฝั

2. **ะะตะบะพะผะตะฝะดะฐัะธั 2: ะะตะฐะปะธะทะพะฒะฐัั ัะธััะพะฒะฐะฝะธะต credentials**
   - ะะฟะธัะฐะฝะธะต: AES-256-GCM ั ะบะปััะพะผ ะธะท ENCRYPTION_KEY env
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะะธะทะบะฐั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 0.5 ะดะฝั

3. **ะะตะบะพะผะตะฝะดะฐัะธั 3: ะกะพะทะดะฐัั Prisma ะผะพะดะตะปั ะธ ะผะธะณัะฐัะธั**
   - ะะฟะธัะฐะฝะธะต: ServiceConfiguration ั ัะธะฟะฐะผะธ ะธ ััะฐัััะฐะผะธ
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะะธะทะบะฐั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 0.5 ะดะฝั

4. **ะะตะบะพะผะตะฝะดะฐัะธั 4: ะะตะฐะปะธะทะพะฒะฐัั ะบะพะฝะฝะตะบัะพัั ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ**
   - ะะฟะธัะฐะฝะธะต: Redis, Prometheus, Loki, Grafana, Sentry
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะกัะตะดะฝัั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 2 ะดะฝั

5. **ะะตะบะพะผะตะฝะดะฐัะธั 5: ะกะพะทะดะฐัั API endpoints**
   - ะะฟะธัะฐะฝะธะต: CRUD + test connection
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะะธะทะบะฐั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 1 ะดะตะฝั

6. **ะะตะบะพะผะตะฝะดะฐัะธั 6: ะกะพะทะดะฐัั UI ะฒ ะฐะดะผะธะฝะบะต**
   - ะะฟะธัะฐะฝะธะต: ะกััะฐะฝะธัะฐ ัะฟัะฐะฒะปะตะฝะธั ัะตัะฒะธัะฐะผะธ ั MUI
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะกัะตะดะฝัั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 1.5 ะดะฝั

7. **ะะตะบะพะผะตะฝะดะฐัะธั 7: ะะฝัะตะณัะธัะพะฒะฐัั ั ัััะตััะฒัััะธะผะธ ะผะพะดัะปัะผะธ**
   - ะะฟะธัะฐะฝะธะต: ะะฑะฝะพะฒะธัั NotificationQueue, RateLimitStore, etc.
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะกัะตะดะฝัั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 1 ะดะตะฝั

8. **ะะตะบะพะผะตะฝะดะฐัะธั 8: ะะฐะฟะธัะฐัั ัะตััั**
   - ะะฟะธัะฐะฝะธะต: Unit, Integration ัะตััั
   - ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ: ะกัะตะดะฝัั
   - ะัะตะฝะบะฐ ะฒัะตะผะตะฝะธ: 1 ะดะตะฝั

---

## ๐ ะัะฒะพะดั

ะะพะดัะปั ะบะพะฝัะธะณััะฐัะธะธ ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ โ ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝัะน ะบะพะผะฟะพะฝะตะฝั ะดะปั ะฟะตัะตัะพะดะฐ ะฟัะพะตะบัะฐ ะธะท development ะฒ production. ะะธะฑัะธะดะฝะฐั ะฐััะธัะตะบัััะฐ (Admin โ ENV โ Default) ะพะฑะตัะฟะตัะธะฒะฐะตั:

1. **ะะฑัะฐัะฝัั ัะพะฒะผะตััะธะผะพััั** โ ัััะตััะฒัััะธะน ะบะพะด ะฟัะพะดะพะปะถะธั ัะฐะฑะพัะฐัั ะฑะตะท ะธะทะผะตะฝะตะฝะธะน
2. **ะะธะฑะบะพััั** โ ะผะพะถะฝะพ ะฟะตัะตะบะปััะฐัััั ะผะตะถะดั ัะตะถะธะผะฐะผะธ ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ
3. **ะะตะทะพะฟะฐัะฝะพััั** โ credentials ะทะฐัะธััะพะฒะฐะฝั ะฒ ะะ
4. **ะฃะดะพะฑััะฒะพ** โ ัะฟัะฐะฒะปะตะฝะธะต ัะตัะตะท UI ะฑะตะท ะดะพัััะฟะฐ ะบ ัะตัะฒะตัั

**ะะฑัะฐั ะพัะตะฝะบะฐ ะฒัะตะผะตะฝะธ:** 8-9 ะดะฝะตะน

**ะกะปะตะดัััะธะต ัะฐะณะธ:**
1. ะกะพะทะดะฐัั ะฟะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ
2. ะะฐัะฐัั ั Prisma ะผะพะดะตะปะธ ะธ ะผะธะณัะฐัะธะธ
3. ะะตะฐะปะธะทะพะฒะฐัั ServiceConfigResolver
4. ะกะพะทะดะฐัั API ะธ UI

---

## ๐ ะกะฒัะทะฐะฝะฝัะต ะดะพะบัะผะตะฝัั

- [AI_MODULE_STANDARDS](../../AI_MODULE_STANDARDS.md)
- [AI_WORKFLOW_GUIDE](../../AI_WORKFLOW_GUIDE.md)
- [ะะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ](../../plans/active/plan-service-configuration-module-2025-11-25.md) - ัะพะทะดะฐะฝ ะฟะพัะปะต ะฐะฝะฐะปะธะทะฐ





